import Layout from './Layout';
export { syntaxHighlighterPrism as theme } from 'mdx-deck/themes';

# Axios examples

## https://github.com/axios/axios

---

export default Layout;

# Basic api

```js
// Get request
axios
  .get('/user?ID=12345')
  .then(response => {
    // handle success
    console.log(res.data);
  })
  .catch(console.error);
// Post request
axios.post('/user', {
  firstName: 'Fred',
  lastName: 'Flintstone'
});
```

# Instances

```js
const loginService = axios.create({
  baseURL: 'https://some-domain.com/api/login/'
});

const { data } = await loginService.get('/get-token');

const customerService = axios.create({
  baseURL: 'https://some-domain.com/api/customer/',
  headers: { Authorization: data.bearerToken }
});
```

# Common

```js
// IMPORTANT: defaults are not inherited unless in axios 0.19 beta

axios.defaults.headers.common['Authorization'] = AUTH_TOKEN;

const searchService = axios.create({
  baseURL: 'https://some-domain.com/api/search/'
});

const customerService = axios.create({
  baseURL: 'https://some-domain.com/api/customer/'
});

// Should inherit in v0.19
customerService.defaults.headers.common ===
  searchService.defaults.headers.common;
```

# Interceptors

```js
// Auto fetch Bearer
const instance = axios.create({ baseURL: 'https://some-domain.com/api/' });

// Request
const autoAuthorize = ({ apiKey }) => config => {
  const existing = _get(instance, 'defaults.headers.authorization');

  // Do nothing if we already have a bearer
  if (existing) return Promise.resolve(config);

  // Else fetch a new token
  return loginService.post('/get-token?key=$\{apiKey}').then({ data } => {
    instance.defaults.headers.authorization = data.bearerToken;
    // Replay the request with the added token
    _set(config, 'headers.authorization', data.bearerToken);
    return config;
  });
};

// Response
const soapToJson = (response) => xmlToJson(res.data, { explicitArray: false })

instance.interceptors.request.use(autoAuthorize({ apiKey: 'apple'}));
instance.interceptors.response.use(soapToJson);

```

# Cancellation

```js
const CancelToken = axios.CancelToken;
const source = CancelToken.source();

axios
  .get('/user/12345', {
    cancelToken: source.token
  })
  .catch(function(thrown) {
    if (axios.isCancel(thrown)) {
      console.log('Request canceled', thrown.message);
    } else {
      // handle error
    }
  });

axios.post(
  '/user/12345',
  {
    name: 'new name'
  },
  {
    cancelToken: source.token
  }
);

// cancel the request (the message parameter is optional)
source.cancel('Operation canceled by the user.');
```

---

# The end
